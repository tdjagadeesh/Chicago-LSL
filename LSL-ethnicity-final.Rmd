---
title: "LSL-ethnicity-final"
author: "Tara Jagadeesh"
date: "10/2/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Limitations: 
-LSL is mapped 1:1 to municipality (thus, some municips are excluded, boundary lines may not overlap exactly, etc etc)
-Missing from LSL_ethnicity are some big municips: Urbana, Belleville, Danville, Burbank, Homer glen village, Machesney park, Bourbonnais, Godfrey, Fairview Heights, Swansea, Shiloh, Justice, campton hills, Roscoe  (all are >10,000 people)



```{r}
#Load packages
library(tidyverse) #Data wrangling
library(sf) #Shapefiles
library(here) #Loading data
library(rgdal)

```

```{r}
#Get data in form for mapping
############################# Data Wrangling ############################# 

#Data for LSL inventory
# Load
SL <- read_csv("ServiceLineMaterialInventoryReports.csv")
# Clean
LSL <- SL %>% 
  filter(ReportingYear == "2018") %>%  #Filter for 2018 data
  mutate(NAME = str_replace(FacilityName, " \\(.*\\)", "")) %>% #Remove parenthesis from facility
  mutate(NAME = str_remove(NAME, pattern = "MHP" )) %>% #Remove "MHP" from facility
  mutate(NAME = str_remove(NAME, pattern = "PWD" )) %>%  #Remove "PWD" from facility
  mutate(NAME = str_remove(NAME, pattern = "Illinois American - " )) %>% 
  mutate(NAME = str_remove(NAME, pattern = "Aqua Illinois - " )) %>% 
  mutate(NAME = str_remove(NAME, pattern = "Aqua Illinois-" )) %>% 
  mutate(NAME = str_remove(NAME, pattern = "Util Inc - " ))
  

#Combining LSL data with municipality data
## Data for municipalities does not have facility ID, so must use a different dataset which contains both municipality and the associated water distributor to more easily join the two layers. Unfortunately this data only exists for 2012, so must do some manual wrangling in excel. Output of this editing is "LSL_municip_join_to_boundaries.csv"

# Load ISWS 2012 municipality data
IL_boundaries_prelim <-read_sf(dsn = here("Map-Data","Illinois_Municipal_Water_Use_2012"), layer = "ISWS_Municipal_Water_Use_2012") %>% 
  rename(FacilityId = FAC_ID)

st_crs(IL_boundaries_prelim) <- 4267

# Join to LSL data
LSL_municip_prelim <- merge(LSL, IL_boundaries_prelim, by= "FacilityId")

# Export as .csv
# st_write(LSL_municip_prelim, "LSL_municip_join.csv", layer_options = "GEOMETRY=AS_XY")

##Now we must do some manual editing in excel to account for the changes between 2012 and 2018. Notes of manual edits: Willowbrook (divided into village and CDP), La Fayette (assign new facility id), Powers Water Co, Inc. (PWS) (delete), Illinois American - West Suburban (PWS) (delete duplicate), Auburn (assign diff facility id)

#LSL Data + Municipality 
# Load 2018 municipality data
IL_boundaries <- read_sf(dsn = here("Map-Data","IL-boundaries"), layer = "tl_2018_17_place") %>% 
  rename(Place = NAME) %>% 
  arrange(Place) 
IL_boundaries[1337, 5] = "Willowbrook CDP" #Manually change Willowbrook CDP name
IL_boundaries[1343, 5] = "New Windsor"

# Manually add New Windsor
LSL_windsor <- LSL %>% 
  filter(FacilityName == "New Windsor (PWS)") %>% 
  rename(Place = NAME)
IL_bound_windsor <- IL_boundaries %>% 
  filter(Place == "New Windsor") 
windsor <- merge(LSL_windsor, IL_bound_windsor, by = "Place") %>% 
  mutate(Class = "village")

# Merge with the manually edited LSL_municip_prelim (to get updated boundaries)
LSL_municip_prelim_edit <- read_csv("LSL_municip_join_to_boundaries.csv")
LSL_municip <- merge(LSL_municip_prelim_edit, IL_boundaries, by= "Place") %>% 
  filter(GEOID != 1728950) %>% 
  rbind(., windsor) %>% #Add New Windsor data point
  select(-Class, -geometry)

# Merge with the added municipalities
LSL_municip_add <- read_csv("LSL_municip_join_to_boundaries3.csv") %>% 
  drop_na() %>% 
  select(-Place) %>% 
  rename(Place = Place_1) 

LSL_municip_final <- rbind(LSL_municip, LSL_municip_add) %>% 
  mutate(potential = ServicesLead + ServicesUnknownMaterial,
         perc_lead = ServicesLead/TotalServiceConnections*100,
         perc_potential = (ServicesLead + ServicesUnknownMaterial)/TotalServiceConnections*100,
         perc_UK = ServicesUnknownMaterial/TotalServiceConnections*100,
         Place = gsub("\u00A0", " ", Place, fixed = TRUE)) #Fix the spaces (some were different lengths from excel)
  

# Find the non-overlapping municipalities (AKA which municips will be missing from the final analysis) 
outersect <- function(x, y) {
  sort(c(setdiff(x, y),
         setdiff(y, x)))
}

missing_municip <- data.frame("Place" = outersect(LSL_municip_final$Place, IL_boundaries$Place))

# st_write(LSL_municip, dsn = here("Map-Data","LSL-municip"), layer="LSL-municip", driver="ESRI Shapefile")


```

```{r}
############################# Demographics Data ############################# 
#Load ethnicity data (data from IL Census Bureau, American Community Survey 2018. Edited in excel to keep only the ethnicity columns)
ethnicity <- read_csv(here("Map-Data","Demographics", "demographics-municip", "demographics-ethnicity-final.csv")) %>% 
  separate(., GEOID, c("x","GEOID"), sep = "US") %>% 
  select(-x) %>% 
  mutate(total_hispanic_perc = as.numeric(total_hispanic_perc), 
         mexican_perc = as.numeric(mexican_perc),
         PR_perc = as.numeric(PR_perc),
         cuban_perc = as.numeric(cuban_perc),
         hispanic_other_perc = as.numeric(hispanic_other_perc),
         total_nothisp_perc = as.numeric(total_nothisp_perc),
         white_perc = as.numeric(white_perc),
         black_perc = as.numeric(black_perc),
         native_perc = as.numeric(native_perc),
         asian_perc = as.numeric(asian_perc),
         PI_perc = as.numeric(PI_perc)) #Convert percentages from character to numeric

#Combine with LSL data
LSL_ethnicity <- merge(LSL_municip_final,ethnicity, by = "GEOID")

#Select for columns of interest
LSL_ethnicity_filter <- LSL_ethnicity %>% 
  select(GEOID, Place, County, FacilityId, TotalServiceConnections, ServicesLead, ServicesUnknownMaterial, potential, perc_lead, perc_potential, perc_UK, total, 
         white, 
         white_perc, 
         black, 
         black_perc, 
         hispanic = total_hispanic,
         hispanic_perc = total_hispanic_perc) %>% 
  filter(GEOID != 1777005) #Remove Urbana Champaign (# lines is too small to match pop size)

```

```{r}

############################# Basic Statistics ############################# 

#Total # of LSLs
# TOTAL lines
sum(LSL$TotalServiceConnections) #3842374
# Known lead
sum(LSL$ServicesLead) #686259
# Potentially lead
sum(LSL$ServicesLead + LSL$ServicesUnknownMaterial) #1753908

#Total # of black residents
sum(ethnicity$black) #1,753,641

#% of state population that is black
sum(ethnicity$black)/sum(ethnicity$total)*100 #15.5%
```

# Analysis 1 - Correlation between race and LSL
```{r}
############################# Correlations (Known LSLs)  ############################# 

######### With Chicago ######### 
#Black + Known LSL
  # (#Black by #LSL known)
  ggplot(LSL_ethnicity_filter, aes(x = black, y = ServicesLead)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_numB_numLSL_K <- lm(black ~ ServicesLead, data = LSL_ethnicity_filter)
  summary(lm_numB_numLSL_K)
  
  # (#Black by %LSL known)
  ggplot(LSL_ethnicity_filter, aes(x = black, y = perc_lead)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_numB_percLSL_K <- lm(black ~ perc_lead, data = LSL_ethnicity_filter)
  summary(lm_numB_percLSL_K)
  
  # (%Black by #LSL known)
  ggplot(LSL_ethnicity_filter, aes(x = black_perc, y = ServicesLead)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_percB_numLSL_K <- lm(black_perc ~ ServicesLead, data = LSL_ethnicity_filter)
  summary(lm_percB_numLSL_K)
  
  # (%Black by %LSL known)
  ggplot(LSL_ethnicity_filter, aes(x = black_perc, y = perc_lead)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_percB_percLSL_K <- lm(black_perc ~ perc_lead, data = LSL_ethnicity_filter)
  summary(lm_percB_percLSL_K)

#White + Known LSL
  # (#White by #LSL known)
  ggplot(LSL_ethnicity_filter, aes(x = white, y = ServicesLead)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_numW_numLSL_K <- lm(white ~ ServicesLead, data = LSL_ethnicity_filter)
  summary(lm_numW_numLSL_K)
  
  # (#White by %LSL known)
  ggplot(LSL_ethnicity_filter, aes(x = white, y = perc_lead)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_numW_percLSL_K <- lm(white ~ perc_lead, data = LSL_ethnicity_filter)
  summary(lm_numW_percLSL_K)
  
  # (%White by #LSL known)
  ggplot(LSL_ethnicity_filter, aes(x = white_perc, y = ServicesLead)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_percW_numLSL_K <- lm(white_perc ~ ServicesLead, data = LSL_ethnicity_filter)
  summary(lm_percW_numLSL_K)
  
  # (%White by %LSL known)
  ggplot(LSL_ethnicity_filter, aes(x = white_perc, y = perc_lead)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_percW_percLSL_K <- lm(white_perc ~ perc_lead, data = LSL_ethnicity_filter)
  summary(lm_percW_percLSL_K)


######### Without Chicago ######### 

LSL_ethnicity_noChi <- LSL_ethnicity_filter %>% 
  filter(Place != "Chicago")

#Black + Known LSL
  # (#Black by #LSL known)
  ggplot(LSL_ethnicity_noChi, aes(x = black, y = ServicesLead)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_numB_numLSL_K_noChi <- lm(black ~ ServicesLead, data = LSL_ethnicity_noChi)
  summary(lm_numB_numLSL_K_noChi)
  
  summary(lm_numB_numLSL_K_noChi)$r.squared
  
  # (#Black by %LSL known)
  ggplot(LSL_ethnicity_noChi, aes(x = black, y = perc_lead)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_numB_percLSL_K_noChi <- lm(black ~ perc_lead, data = LSL_ethnicity_noChi)
  summary(lm_numB_percLSL_K_noChi)
  
  # (%Black by #LSL known)
  ggplot(LSL_ethnicity_noChi, aes(x = black_perc, y = ServicesLead)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_percB_numLSL_K_noChi <- lm(black_perc ~ ServicesLead, data = LSL_ethnicity_noChi)
  summary(lm_percB_numLSL_K_noChi)
  
  # (%Black by %LSL known)
  ggplot(LSL_ethnicity_noChi, aes(x = black_perc, y = perc_lead)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_percB_percLSL_K_noChi <- lm(black_perc ~ perc_lead, data = LSL_ethnicity_noChi)
  summary(lm_percB_percLSL_K_noChi)

#White + Known LSL
  # (#White by #LSL known)
  ggplot(LSL_ethnicity_noChi, aes(x = white, y = ServicesLead)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_numW_numLSL_K_noChi <- lm(white ~ ServicesLead, data = LSL_ethnicity_noChi)
  summary(lm_numW_numLSL_K_noChi)
  
  # (#White by %LSL known)
  ggplot(LSL_ethnicity_noChi, aes(x = white, y = perc_lead)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_numW_percLSL_K_noChi <- lm(white ~ perc_lead, data = LSL_ethnicity_noChi)
  summary(lm_numW_percLSL_K_noChi)
  
  # (%White by #LSL known)
  ggplot(LSL_ethnicity_noChi, aes(x = white_perc, y = ServicesLead)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_percW_numLSL_K_noChi <- lm(white_perc ~ ServicesLead, data = LSL_ethnicity_noChi)
  summary(lm_percW_numLSL_K_noChi)
  
  # (%White by %LSL known)
  ggplot(LSL_ethnicity_noChi, aes(x = white_perc, y = perc_lead)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_percW_percLSL_K_noChi <- lm(white_perc ~ perc_lead, data = LSL_ethnicity_noChi)
  summary(lm_percW_percLSL_K_noChi)

  

  analysis_1 <- data.frame("name" = c("perc_black", "num_black", "perc_white", "num_white"))

#Known LSL with chicago
round(summary(lm_percB_percLSL_K)$coefficients[2], 2)
round(summary(lm_percB_percLSL_K)$coefficients[1], 2)
round(summary(lm_percB_percLSL_K)$r.square, 2)

round(summary(lm_numB_percLSL_K)$coefficients[2], 2)
round(summary(lm_numB_percLSL_K)$coefficients[1], 2)
round(summary(lm_numB_percLSL_K)$r.square, 2)


round(summary(lm_percW_percLSL_K)$coefficients[2], 2)
round(summary(lm_percW_percLSL_K)$coefficients[1], 2)
round(summary(lm_percW_percLSL_K)$r.square, 2)

round(summary(lm_numW_percLSL_K)$coefficients[2], 2)
round(summary(lm_numW_percLSL_K)$coefficients[1], 2)
round(summary(lm_numW_percLSL_K)$r.square, 2)

#######
round(summary(lm_percB_numLSL_K)$coefficients[2], 2)
round(summary(lm_percB_numLSL_K)$coefficients[1], 2)
round(summary(lm_percB_numLSL_K)$r.square, 2)

round(summary(lm_numB_numLSL_K)$coefficients[2], 2)
round(summary(lm_numB_numLSL_K)$coefficients[1], 2)
round(summary(lm_numB_numLSL_K)$r.square, 2)


round(summary(lm_percW_numLSL_K)$coefficients[2], 2)
round(summary(lm_percW_numLSL_K)$coefficients[1], 2)
round(summary(lm_percW_numLSL_K)$r.square, 2)

round(summary(lm_numW_numLSL_K)$coefficients[2], 2)
round(summary(lm_numW_numLSL_K)$coefficients[1], 2)
round(summary(lm_numW_numLSL_K)$r.square, 2)

#Known LSL without chicago
round(summary(lm_percB_percLSL_K_noChi)$coefficients[2], 2)
round(summary(lm_percB_percLSL_K_noChi)$coefficients[1], 2)
round(summary(lm_percB_percLSL_K_noChi)$r.square, 2)

round(summary(lm_numB_percLSL_K_noChi)$coefficients[2], 2)
round(summary(lm_numB_percLSL_K_noChi)$coefficients[1], 2)
round(summary(lm_numB_percLSL_K_noChi)$r.square, 2)

round(summary(lm_percW_percLSL_K_noChi)$coefficients[2], 2)
round(summary(lm_percW_percLSL_K_noChi)$coefficients[1], 2)
round(summary(lm_percW_percLSL_K_noChi)$r.square, 2)

round(summary(lm_numW_percLSL_K_noChi)$coefficients[2], 2)
round(summary(lm_numW_percLSL_K_noChi)$coefficients[1], 2)
round(summary(lm_numW_percLSL_K_noChi)$r.square, 2)

#######
round(summary(lm_percB_numLSL_K_noChi)$coefficients[2], 2)
round(summary(lm_percB_numLSL_K_noChi)$coefficients[1], 2)
round(summary(lm_percB_numLSL_K_noChi)$r.square, 2)

round(summary(lm_numB_numLSL_K_noChi)$coefficients[2], 2)
round(summary(lm_numB_numLSL_K_noChi)$coefficients[1], 2)
round(summary(lm_numB_numLSL_K_noChi)$r.square, 2)


round(summary(lm_percW_numLSL_K_noChi)$coefficients[2], 2)
round(summary(lm_percW_numLSL_K_noChi)$coefficients[1], 2)
round(summary(lm_percW_numLSL_K_noChi)$r.square, 2)

round(summary(lm_numW_numLSL_K_noChi)$coefficients[2], 2)
round(summary(lm_numW_numLSL_K_noChi)$coefficients[1], 2)
round(summary(lm_numW_numLSL_K_noChi)$r.square, 2)



```

```{r}
############################# Correlations (Potential LSLs)  ############################# 

######### With Chicago ######### 
#Black + Potential LSL
  # (#Black by #LSL Potential)
  ggplot(LSL_ethnicity_filter, aes(x = black, y = potential)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_numB_numLSL_P <- lm(black ~ potential, data = LSL_ethnicity_filter)
  summary(lm_numB_numLSL_P)
  
  # (#Black by %LSL Potential)
  ggplot(LSL_ethnicity_filter, aes(x = black, y = perc_potential)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_numB_percLSL_P <- lm(black ~ perc_potential, data = LSL_ethnicity_filter)
  summary(lm_numB_percLSL_P)
  
  # (%Black by #LSL Potential)
  ggplot(LSL_ethnicity_filter, aes(x = black_perc, y = potential)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_percB_numLSL_P <- lm(black_perc ~ potential, data = LSL_ethnicity_filter)
  summary(lm_percB_numLSL_P)
  
  # (%Black by %LSL Potential)
  ggplot(LSL_ethnicity_filter, aes(x = black_perc, y = perc_potential)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_percB_percLSL_P <- lm(black_perc ~ perc_potential, data = LSL_ethnicity_filter)
  summary(lm_percB_percLSL_P)

#White + Potential LSL
  # (#White by #LSL Potential)
  ggplot(LSL_ethnicity_filter, aes(x = white, y = potential)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_numW_numLSL_P <- lm(white ~ potential, data = LSL_ethnicity_filter)
  summary(lm_numW_numLSL_P)
  
  # (#White by %LSL Potential)
  ggplot(LSL_ethnicity_filter, aes(x = white, y = perc_potential)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_numW_percLSL_P <- lm(white ~ perc_potential, data = LSL_ethnicity_filter)
  summary(lm_numW_percLSL_P)
  
  # (%White by #LSL Potential)
  ggplot(LSL_ethnicity_filter, aes(x = white_perc, y = potential)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_percW_numLSL_P <- lm(white_perc ~ potential, data = LSL_ethnicity_filter)
  summary(lm_percW_numLSL_P)
  
  # (%White by %LSL Potential)
  ggplot(LSL_ethnicity_filter, aes(x = white_perc, y = perc_potential)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_percW_percLSL_P <- lm(white_perc ~ perc_potential, data = LSL_ethnicity_filter)
  summary(lm_percW_percLSL_P)


######### Without Chicago ######### 

LSL_ethnicity_noChi <- LSL_ethnicity_filter %>% 
  filter(Place != "Chicago")

#Black + Potential LSL
  # (#Black by #LSL Potential)
  ggplot(LSL_ethnicity_noChi, aes(x = black, y = potential)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_numB_numLSL_P_noChi <- lm(black ~ potential, data = LSL_ethnicity_noChi)
  summary(lm_numB_numLSL_P_noChi)
  
  # (#Black by %LSL Potential)
  ggplot(LSL_ethnicity_noChi, aes(x = black, y = perc_potential)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_numB_percLSL_P_noChi <- lm(black ~ perc_potential, data = LSL_ethnicity_noChi)
  summary(lm_numB_percLSL_P_noChi)
  
  # (%Black by #LSL Potential)
  ggplot(LSL_ethnicity_noChi, aes(x = black_perc, y = potential)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_percB_numLSL_P_noChi <- lm(black_perc ~ potential, data = LSL_ethnicity_noChi)
  summary(lm_percB_numLSL_P_noChi)
  
  # (%Black by %LSL Potential)
  ggplot(LSL_ethnicity_noChi, aes(x = black_perc, y = perc_potential)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_percB_percLSL_P_noChi <- lm(black_perc ~ perc_potential, data = LSL_ethnicity_noChi)
  summary(lm_percB_percLSL_P_noChi)

#White + Potential LSL
  # (#White by #LSL Potential)
  ggplot(LSL_ethnicity_noChi, aes(x = white, y = potential)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_numW_numLSL_P_noChi <- lm(white ~ potential, data = LSL_ethnicity_noChi)
  summary(lm_numW_numLSL_P_noChi)
  
  # (#White by %LSL Potential)
  ggplot(LSL_ethnicity_noChi, aes(x = white, y = perc_potential)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_numW_percLSL_P_noChi <- lm(white ~ perc_potential, data = LSL_ethnicity_noChi)
  summary(lm_numW_percLSL_P_noChi)
  
  # (%White by #LSL Potential)
  ggplot(LSL_ethnicity_noChi, aes(x = white_perc, y = potential)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_percW_numLSL_P_noChi <- lm(white_perc ~ potential, data = LSL_ethnicity_noChi)
  summary(lm_percW_numLSL_P_noChi)
  
  # (%White by %LSL Potential)
  ggplot(LSL_ethnicity_noChi, aes(x = white_perc, y = perc_potential)) +
    geom_point()+
    geom_smooth(method=lm)
  lm_percW_percLSL_P_noChi <- lm(white_perc ~ perc_potential, data = LSL_ethnicity_noChi)
  summary(lm_percW_percLSL_P_noChi)


```

# Analysis 2 - Top 50 Blackest and Whitest Communities
```{r}
############################# Top 50 Blackest ############################# 
#50 blackest communities (by #)
top50_black <- LSL_ethnicity_filter %>% 
  arrange(desc(black)) %>% 
  head(50) 

  #Stats
  # % of state black population in top 50
  sum(top50_black$black) #1,423,877
  sum(top50_black$black)/sum(ethnicity$black)*100 #81%
  
  # % of ENTIRE state population in top 50
  sum(top50_black$black) #1,423,877
  sum(top50_black$black)/sum(ethnicity$total)*100 #12%
  
  # with what % of known LSLs?
  sum(top50_black$ServicesLead) #533,598
  sum(top50_black$ServicesLead)/sum(LSL$ServicesLead)*100 #78%
  
  # with what % of unknown LSLs?
  sum(top50_black$ServicesUnknownMaterial) #488,953
  sum(top50_black$ServicesUnknownMaterial)/sum(LSL$ServicesUnknownMaterial)*100 #46%
  
  # with what % of potential LSLs?
  sum(top50_black$potential) #1,022,551
  sum(top50_black$potential)/sum(LSL$ServicesLead + LSL$ServicesUnknownMaterial)*100 #58%
  
  #12% of the state lives with 78% of known LSLs
  
  
#50 blackest communities (by %)
top50_black_perc <- LSL_ethnicity_filter %>% 
  arrange(desc(black_perc)) %>% 
  filter(GEOID != 1765104) %>% #Remove Rock Island Arsenal
  head(50) 

#Stats
  # % of state black population in top 50
  sum(top50_black_perc$black) #1,172,845
  sum(top50_black_perc$black)/sum(ethnicity$black)*100 #69%
  
  # % of ENTIRE state population in top 50
  sum(top50_black_perc$black) #1,172,845
  sum(top50_black_perc$black)/sum(ethnicity$total)*100 #10%
  
  # with what % of known LSLs?
  sum(top50_black_perc$ServicesLead) #427,737
  sum(top50_black_perc$ServicesLead)/sum(LSL$ServicesLead)*100 #62%
  
  # with what % of unknown LSLs?
  sum(top50_black_perc$ServicesUnknownMaterial) #253,215
  sum(top50_black_perc$ServicesUnknownMaterial)/sum(LSL$ServicesUnknownMaterial)*100 #24%
  
  # with what % of potential LSLs?
  sum(top50_black_perc$potential) #680,952
  sum(top50_black_perc$potential)/sum(LSL$ServicesLead + LSL$ServicesUnknownMaterial)*100 #39%



############################# Top 50 Whitest ############################# 
# Filter for the 50 whitest communities (by #)
top50_white <- LSL_ethnicity_filter %>% 
  arrange(desc(white)) %>% 
  head(50) 
  
  #Stats
  # % of state white population in top 50
  sum(top50_white$white) #2,876,429
  sum(top50_white$white)/sum(ethnicity$white)*100 #44%
        #When comparing to black data, this tells us that the state's black population is concentrated          in a few municipalities while the white population is more spread out
  
  # % of ENTIRE state population in top 50
  sum(top50_white$white) #2,876,429
  sum(top50_white$white)/sum(ethnicity$total)*100 #25%
  
  # with what % of known LSLs?
  sum(top50_white$ServicesLead) #533,598
  sum(top50_white$ServicesLead)/sum(LSL$ServicesLead)*100 #77%
  
  # with what % of unknown LSLs?
  sum(top50_white$ServicesUnknownMaterial) #414,782
  sum(top50_white$ServicesUnknownMaterial)/sum(LSL$ServicesUnknownMaterial)*100 #38%
  
  # with what % of potential LSLs?
  sum(top50_white$potential) #946,142
  sum(top50_white$potential)/sum(LSL$ServicesLead + LSL$ServicesUnknownMaterial)*100 #54%
  
  #25% of the state lives with 78% of known LSLs

# Filter for the 50 whitest communities (by %)
top50_white_perc <- LSL_ethnicity_filter %>% 
  arrange(desc(white_perc)) %>% 
  head(50)

  #Stats
  # % of state white population in top 50
  sum(top50_white_perc$white) #17,794
  sum(top50_white_perc$white)/sum(ethnicity$white)*100 #0.27%
        #The whitest communities in the state tend to be smaller, rural communities. Thus I think it            makes more sense to focus on # rather than %
  
  # % of ENTIRE state population in top 50
  sum(top50_white_perc$white) #17,794
  sum(top50_white_perc$white)/sum(ethnicity$total)*100 #0.16%
  
  # with what % of known LSLs?
  sum(top50_white_perc$ServicesLead) #2
  sum(top50_white_perc$ServicesLead)/sum(LSL$ServicesLead)*100 #0.0003%
  
  # with what % of unknown LSLs?
  sum(top50_white_perc$ServicesUnknownMaterial) #4,422
  sum(top50_white_perc$ServicesUnknownMaterial)/sum(LSL$ServicesUnknownMaterial)*100 #0.41%
  
  # with what % of potential LSLs?
  sum(top50_white_perc$potential) #4,424
  sum(top50_white_perc$potential)/sum(LSL$ServicesLead + LSL$ServicesUnknownMaterial)*100 #0.25%

#Thoughts: (1) Focus on top 50 by # black and # white because if you look at % you see only small rural communities for white. Also we want to look at where most of the black community is located. (2) More of the black population is exposed to LSLs than the white population (81% vs 44$%). 

```

# Analysis 3 - Top 50 LSL Communities
```{r}
############################# Top 50 LSLs ############################# 
#Top 50 known LSLs 
top50_LSL_K <- LSL_ethnicity_filter %>% 
  arrange(desc(ServicesLead)) %>% 
  head(50) 

  #Stats
    # % of state black population in top 50 known
    sum(top50_LSL_K$black) #1,143,383
    sum(top50_LSL_K$black)/sum(ethnicity$black)*100 #65%
    
    # % of state white population in top 50 known
    sum(top50_LSL_K$white) #1,952,415
    sum(top50_LSL_K$white)/sum(ethnicity$white)*100 #30%
  
    # Damn......

#Top 50 unknown LSLs 
top50_LSL_UK <- LSL_ethnicity_filter %>% 
  arrange(desc(ServicesUnknownMaterial)) %>% 
  head(50) 

  #Stats
    # % of state black population in top 50 unknown
    sum(top50_LSL_UK$black) #1,094,688
    sum(top50_LSL_UK$black)/sum(ethnicity$black)*100 #62%
    
    # % of state white population in top 50 unknown
    sum(top50_LSL_UK$white) #2,009,575
    sum(top50_LSL_UK$white)/sum(ethnicity$white)*100 #31%

#Top 50 potential LSLs 
top50_LSL_P <- LSL_ethnicity_filter %>% 
  arrange(desc(potential)) %>% 
  head(50) 

  #Stats
    # % of state black population in top 50 unknown
    sum(top50_LSL_P$black) #1,191,107
    sum(top50_LSL_P$black)/sum(ethnicity$black)*100 #68%
    
    # % of state white population in top 50 unknown
    sum(top50_LSL_P$white) #2,223,871
    sum(top50_LSL_P$white)/sum(ethnicity$white)*100 #34%

    sum(top50_LSL_K$ServicesLead)/sum(LSL$ServicesLead)

```

# Analysis 4 - Known LSLs and Average Population
```{r}
#Municipalities where lead service lines account for >10% of lines
LSL_10 <- LSL_ethnicity_filter%>% 
  filter(perc_lead >= 10)

  #Stats
    #Black
    mean(LSL_10$black)
    mean(LSL_10$black_perc)
    
    #White
    mean(LSL_10$white)
    mean(LSL_10$white_perc)
```

```{r}
#Municipalities where lead service lines account for >20% of lines
LSL_20 <- LSL_ethnicity_filter%>% 
  filter(perc_lead >= 20)

  #Stats
    #Black
    mean(LSL_20$black)
    
    mean(LSL_20$black_perc)
    
    #White
    mean(LSL_20$white)
    
    mean(LSL_20$white_perc)
```

```{r}    
    
#Municipalities where lead service lines account for >30% of lines
LSL_30 <- LSL_ethnicity_filter%>% 
  filter(perc_lead >= 30)

  #Stats
    #Black
    mean(LSL_30$black)
    
    mean(LSL_30$black_perc)
    
    #White
    mean(LSL_30$white)
    
    mean(LSL_30$white_perc)
```

```{r}    
#Municipalities where lead service lines account for >40% of lines
LSL_40 <- LSL_ethnicity_filter%>% 
  filter(perc_lead >= 40)

  #Stats
    #Black
    mean(LSL_40$black)
    mean(LSL_40$black_perc)
    
    #White
    mean(LSL_40$white)
    mean(LSL_40$white_perc)
```

```{r}    
#Municipalities where lead service lines account for >50% of lines
LSL_50 <- LSL_ethnicity_filter%>% 
  filter(perc_lead >= 50)

  #Stats
    #Black
    mean(LSL_50$black)
    
    mean(LSL_50$black_perc)
    
    #White
    mean(LSL_50$white)
    
    mean(LSL_50$white_perc)
```

```{r}    
#Municipalities where lead service lines account for >60% of lines
LSL_60 <- LSL_ethnicity_filter%>% 
  filter(perc_lead >= 60)

  #Stats
    #Black
    mean(LSL_60$black)
    
    mean(LSL_60$black_perc)
    
    #White
    mean(LSL_60$white)
    
    mean(LSL_60$white_perc)
```

# Analysis 5 - Unknown LSLs and Average Population
```{r}
#Municipalities where unknown service lines account for >10% of lines
LSL_UK_10 <- LSL_ethnicity_filter %>% 
  filter(perc_UK >= 10)

  #Stats
    #Black
    mean(LSL_UK_10$black)
    mean(LSL_UK_10$black_perc)
    
    #White
    mean(LSL_UK_10$white)
    mean(LSL_UK_10$white_perc)
```

```{r}
#Municipalities where unknown service lines account for >20% of lines
LSL_UK_20 <- LSL_ethnicity_filter%>% 
  filter(perc_UK >= 20)

  #Stats
    #Black
    mean(LSL_UK_20$black)
    
    mean(LSL_UK_20$black_perc)
    
    #White
    mean(LSL_UK_20$white)
    
    mean(LSL_UK_20$white_perc)
```

```{r}    
    
#Municipalities where unknown service lines account for >30% of lines
LSL_UK_30 <- LSL_ethnicity_filter%>% 
  filter(perc_UK >= 30)

  #Stats
    #Black
    mean(LSL_UK_30$black)
    
    mean(LSL_UK_30$black_perc)
    
    #White
    mean(LSL_UK_30$white)
    
    mean(LSL_UK_30$white_perc)
```

```{r}    
#Municipalities where unknown service lines account for >40% of lines
LSL_UK_40 <- LSL_ethnicity_filter%>% 
  filter(perc_UK >= 40)

  #Stats
    #Black
    mean(LSL_UK_40$black)
    mean(LSL_UK_40$black_perc)
    
    #White
    mean(LSL_UK_40$white)
    
    mean(LSL_UK_40$white_perc)
```

```{r}    
#Municipalities where unknown service lines account for >50% of lines
LSL_UK_50 <- LSL_ethnicity_filter%>% 
  filter(perc_UK >= 50)

  #Stats
    #Black
    mean(LSL_UK_50$black)
    
    mean(LSL_UK_50$black_perc)
    
    #White
    mean(LSL_UK_50$white)
    
    mean(LSL_UK_50$white_perc)
```

```{r}    
#Municipalities where unknown service lines account for >60% of lines
LSL_UK_60 <- LSL_ethnicity_filter%>% 
  filter(perc_UK >= 60)

  #Stats
    #Black
    mean(LSL_UK_60$black)
    mean(LSL_UK_60$black_perc)
    
    #White
    mean(LSL_UK_60$white)
    mean(LSL_UK_60$white_perc)
```

```{r}    
#Municipalities where unknown service lines account for >60% of lines
LSL_UK_70 <- LSL_ethnicity_filter%>% 
  filter(perc_UK >= 70)

  #Stats
    #Black
    mean(LSL_UK_70$black)
    mean(LSL_UK_70$black_perc)
    
    #White
    mean(LSL_UK_70$white)
    mean(LSL_UK_70$white_perc)
```

```{r}    
#Municipalities where unknown service lines account for >60% of lines
LSL_UK_90 <- LSL_ethnicity_filter%>% 
  filter(perc_UK >= 90)

  #Stats
    #Black
    mean(LSL_UK_90$black)
    mean(LSL_UK_90$black_perc)
    
    #White
    mean(LSL_UK_90$white)
    mean(LSL_UK_90$white_perc)
```
